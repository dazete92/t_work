debug (7 | 24)

on ready {
	local('$console');
	$console = console();
	cmd($console, "show exploits");
}

on console_show {
	local('$line $name $os $date $rank $des $rankNum $port $modRank %options');

	foreach $line (split("\n", $3)) {
		if (($line ismatch '\s+((.*?)\/.*?\/.*?)\s+(\d\d\d\d-\d\d-\d\d)\s+(.*?)\s+(.*?)') || 
		   ($line ismatch '\s+((.*?)\/.*?)\s+(\d\d\d\d-\d\d-\d\d)\s+(.*?)\s+(.*?)')) {
		   
			($name, $os, $date, $rank, $des) = matched();
			$rankNum = determineNumericalRank($rank);
			$modRank = double($rankNum);
			%options = options("exploit", $name);
			$port = findPortNumber(%options);
			println("$port" . "," . "$name" . "," . "$os" . "," . "$date" . "," . 
			   "$rank" . "," . "$rankNum" . "," . "$modRank" . "," . "$des");
		}
	}
	quit();
}

sub determineNumericalRank {
	return %(manual => 0, low => 1, average => 2, normal => 3, good => 4, great => 5, excellent => 6)[$1];
}

sub findPortNumber {
	local('%o');
	%o = $1;
	if ("RPORT" in %o && "default" in %o["RPORT"]) {
		return %o["RPORT"]["default"];
	}
	else if ("SRVPORT" in %o) {
		return %o["SRVPORT"]["default"];
	}
	else {
		return "None";
	}
}

